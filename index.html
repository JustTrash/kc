<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç§»åŠ¨ç«¯æŒæœ‰æˆæœ¬è®¡ç®—å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.5;
            padding: 0;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background-color: white;
            padding: 16px;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            padding-top: 10px;
        }
        
        h1 {
            color: #2c3e50;
            font-size: 22px;
            margin-bottom: 8px;
            font-weight: 700;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .calculator {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .card {
            background-color: white;
            border-radius: 12px;
            padding: 18px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
            border: 1px solid #eef1f5;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            padding-bottom: 12px;
            border-bottom: 1px solid #f0f2f5;
        }
        
        .card-title i {
            margin-right: 8px;
            font-size: 20px;
        }
        
        .form-group {
            margin-bottom: 18px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #555;
            font-size: 14px;
        }
        
        .input-with-unit {
            position: relative;
            margin-bottom: 8px;
        }
        
        input, select {
            width: 100%;
            padding: 14px 16px;
            border: 1.5px solid #e1e5eb;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.2s;
            background-color: #fafbfc;
            -webkit-appearance: none;
            appearance: none;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #3498db;
            background-color: white;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .unit {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #7f8c8d;
            font-weight: 500;
            font-size: 15px;
        }
        
        .slider-container {
            margin-top: 12px;
            padding: 0 4px;
        }
        
        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e1e5eb;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }
        
        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }
        
        .percentage-display {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 4px;
            text-align: right;
        }
        
        .parameter-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }
        
        @media (max-width: 380px) {
            .parameter-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
        }
        
        .loan-summary {
            background-color: #f8fafc;
            border-radius: 10px;
            padding: 16px;
            margin: 16px 0;
            border-left: 4px solid #3498db;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eef2f7;
        }
        
        .summary-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
            font-weight: 600;
            color: #3498db;
        }
        
        .button {
            display: block;
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 20px;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.2);
        }
        
        .button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.2);
        }
        
        .button:hover {
            background: linear-gradient(135deg, #2980b9, #2573a7);
        }
        
        .note {
            margin-top: 20px;
            padding: 16px;
            background-color: #fff8e6;
            border-radius: 10px;
            border-left: 4px solid #f1c40f;
            font-size: 13px;
            line-height: 1.5;
        }
        
        .error {
            color: #e74c3c;
            font-size: 13px;
            margin-top: 5px;
            display: none;
        }
        
        .result-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .result-box {
            background-color: white;
            border-radius: 10px;
            padding: 16px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid #eef1f5;
        }
        
        .result-title {
            font-size: 14px;
            color: #7f8c8d;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .result-value {
            font-size: 24px;
            font-weight: 700;
            margin: 8px 0;
        }
        
        .result-value.blue {
            color: #3498db;
        }
        
        .result-value.red {
            color: #e74c3c;
        }
        
        .result-detail {
            font-size: 12px;
            color: #95a5a6;
            margin-top: 4px;
        }
        
        .cost-breakdown {
            background-color: #f8fafc;
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 20px;
        }
        
        .cost-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #eef2f7;
        }
        
        .cost-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
            font-weight: 600;
        }
        
        .cost-label {
            display: flex;
            align-items: center;
            font-size: 14px;
        }
        
        .cost-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-size: 12px;
            font-weight: bold;
            color: white;
        }
        
        .icon-opportunity {
            background-color: #2ecc71;
        }
        
        .icon-depreciation {
            background-color: #9b59b6;
        }
        
        .icon-interest {
            background-color: #e74c3c;
        }
        
        .icon-total {
            background-color: #3498db;
        }
        
        .time-filter {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
            padding: 8px 0;
        }
        
        .time-btn {
            padding: 8px 16px;
            background-color: #f8f9fa;
            border: 1.5px solid #e1e5eb;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
            white-space: nowrap;
        }
        
        .time-btn.active {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        .month-selector {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
            padding: 12px;
            background-color: #f8f9fa;
            border-radius: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .month-selector span {
            font-size: 14px;
            color: #555;
        }
        
        .month-selector input {
            width: 70px;
            padding: 10px;
            text-align: center;
            font-size: 15px;
            margin: 0 8px;
        }
        
        .month-selector button {
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }
        
        .monthly-table-container {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 10px;
            border: 1px solid #e1e5eb;
            border-radius: 10px;
            -webkit-overflow-scrolling: touch;
        }
        
        .monthly-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }
        
        .monthly-table th {
            background-color: #f8f9fa;
            padding: 12px 10px;
            text-align: center;
            font-weight: 600;
            color: #2c3e50;
            position: sticky;
            top: 0;
            z-index: 10;
            border-bottom: 2px solid #e1e5eb;
            font-size: 13px;
        }
        
        .monthly-table td {
            padding: 10px 8px;
            text-align: center;
            border-bottom: 1px solid #eee;
            font-size: 12px;
        }
        
        .monthly-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .monthly-table tr:active {
            background-color: #f0f7ff;
        }
        
        .year-header {
            background-color: #e8f4fc !important;
            font-weight: bold !important;
            font-size: 13px !important;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #95a5a6;
            font-size: 12px;
            padding: 20px 0;
            border-top: 1px solid #eee;
        }
        
        .highlight {
            background-color: #fffacd;
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .collapse-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            cursor: pointer;
            border-bottom: 1px solid #eef2f7;
        }
        
        .collapse-content {
            padding: 16px 0;
            display: none;
        }
        
        .collapse-content.active {
            display: block;
        }
        
        .collapse-arrow {
            transition: transform 0.3s;
        }
        
        .collapse-arrow.active {
            transform: rotate(180deg);
        }
        
        @media (max-width: 480px) {
            .result-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .month-selector {
                flex-direction: column;
                align-items: stretch;
            }
            
            .month-selector input {
                width: 100%;
                margin: 8px 0;
            }
            
            .month-selector button {
                width: 100%;
            }
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #3498db;
        }
        
        .emoji {
            font-size: 18px;
            margin-right: 8px;
        }
        
        .year-cost-selector {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
            padding: 12px;
            background-color: #f0f7ff;
            border-radius: 10px;
            border: 1px solid #3498db;
        }
        
        .year-cost-selector label {
            margin-bottom: 0;
            font-weight: 600;
            color: #3498db;
        }
        
        .year-cost-selector input {
            width: 80px;
            padding: 10px;
            text-align: center;
            font-size: 16px;
            font-weight: 600;
        }
        
        .year-cost-result {
            background-color: #e8f4fc;
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 16px;
            border-left: 4px solid #3498db;
        }
        
        .year-cost-result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #d1e7f7;
        }
        
        .year-cost-result-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
            font-weight: 600;
            color: #3498db;
        }
        
        .year-cost-value {
            font-weight: 600;
            color: #e74c3c;
        }
        
        .comparison-bar {
            display: flex;
            align-items: center;
            margin-top: 8px;
            height: 8px;
            background-color: #e1e5eb;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .comparison-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2980b9);
            border-radius: 4px;
        }
        
        .cost-distribution {
            margin-top: 16px;
        }
        
        .distribution-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .distribution-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .distribution-label {
            font-size: 13px;
            color: #555;
            flex: 1;
        }
        
        .distribution-value {
            font-size: 13px;
            font-weight: 600;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“± æˆ¿äº§æŒæœ‰æˆæœ¬è®¡ç®—å™¨</h1>
            <p class="subtitle">è¾“å…¥æˆ¿å±‹ä¿¡æ¯ï¼Œè®¡ç®—æ¯æœˆæœˆä¾›å’ŒçœŸå®æŒæœ‰æˆæœ¬</p>
        </header>
        
        <div class="calculator">
            <!-- è¾“å…¥å‚æ•°åŒºåŸŸ -->
            <div class="card">
                <div class="card-title">
                    <span class="emoji">ğŸ </span> æˆ¿å±‹ä¿¡æ¯
                </div>
                
                <div class="form-group">
                    <label for="totalPrice">æˆ¿å±‹æ€»ä»·</label>
                    <div class="input-with-unit">
                        <input type="number" id="totalPrice" min="1" max="2000" step="1" value="300">
                        <span class="unit">ä¸‡å…ƒ</span>
                    </div>
                    <div class="slider-container">
                        <input type="range" id="totalPriceSlider" min="1" max="2000" step="1" value="300" class="slider">
                    </div>
                    <div id="totalPriceError" class="error">è¯·è¾“å…¥æœ‰æ•ˆçš„æˆ¿å±‹æ€»ä»·</div>
                </div>
                
                <div class="form-group">
                    <label for="downPayment">é¦–ä»˜é‡‘é¢</label>
                    <div class="input-with-unit">
                        <input type="number" id="downPayment" min="0" max="2000" step="1" value="100">
                        <span class="unit">ä¸‡å…ƒ</span>
                    </div>
                    <div class="slider-container">
                        <input type="range" id="downPaymentSlider" min="0" max="2000" step="1" value="100" class="slider">
                    </div>
                    <div class="percentage-display" id="downPaymentPercentage">é¦–ä»˜æ¯”ä¾‹ï¼š33.3%</div>
                    <div id="downPaymentError" class="error">é¦–ä»˜é‡‘é¢ä¸èƒ½è¶…è¿‡æˆ¿å±‹æ€»ä»·</div>
                </div>
            </div>
            
            <!-- è‡ªå®šä¹‰å‚æ•°åŒºåŸŸï¼ˆå¯æŠ˜å ï¼‰ -->
            <div class="card">
                <div class="collapse-header" id="customParamsHeader">
                    <div class="card-title">
                        <span class="emoji">âš™ï¸</span> è‡ªå®šä¹‰å‚æ•°
                    </div>
                    <div class="collapse-arrow">â–¼</div>
                </div>
                
                <div class="collapse-content" id="customParamsContent">
                    <div class="parameter-grid">
                        <div class="form-group">
                            <label for="rateLimit">åˆ†æ®µåˆ©ç‡èŠ‚ç‚¹</label>
                            <div class="input-with-unit">
                                <input type="number" id="rateLimit" min="0" max="1000" step="1" value="154">
                                <span class="unit">ä¸‡å…ƒ</span>
                            </div>
                            <div class="percentage-display">â‰¤æ­¤é‡‘é¢éƒ¨åˆ†é€‚ç”¨åˆ©ç‡1</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="opportunityRate">æœºä¼šæˆæœ¬å¹´åˆ©ç‡</label>
                            <div class="input-with-unit">
                                <input type="number" id="opportunityRate" min="0" max="20" step="0.1" value="2.0">
                                <span class="unit">%</span>
                            </div>
                            <div class="percentage-display">é¦–ä»˜èµ„é‡‘çš„å¹´åŒ–æ”¶ç›Šç‡</div>
                        </div>
                    </div>
                    
                    <div class="parameter-grid">
                        <div class="form-group">
                            <label for="rate1">åˆ©ç‡1 (â‰¤èŠ‚ç‚¹éƒ¨åˆ†)</label>
                            <div class="input-with-unit">
                                <input type="number" id="rate1" min="0" max="20" step="0.01" value="2.6">
                                <span class="unit">%</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="rate2">åˆ©ç‡2 (>èŠ‚ç‚¹éƒ¨åˆ†)</label>
                            <div class="input-with-unit">
                                <input type="number" id="rate2" min="0" max="20" step="0.01" value="3.05">
                                <span class="unit">%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="loan-summary">
                        <div class="summary-item">
                            <span>æˆ¿å±‹æ€»ä»·ï¼š</span>
                            <span id="summaryTotalPrice">300 ä¸‡å…ƒ</span>
                        </div>
                        <div class="summary-item">
                            <span>é¦–ä»˜é‡‘é¢ï¼š</span>
                            <span id="summaryDownPayment">100 ä¸‡å…ƒ</span>
                        </div>
                        <div class="summary-item">
                            <span>è´·æ¬¾é‡‘é¢ï¼š</span>
                            <span id="summaryLoanAmount">200 ä¸‡å…ƒ</span>
                        </div>
                        <div class="summary-item">
                            <span>åˆ©ç‡åˆ†æ®µï¼š</span>
                            <span id="summaryRateSplit">â‰¤154ä¸‡:2.6% >154ä¸‡:3.05%</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>è´·æ¬¾æœŸé™</label>
                        <input type="text" value="30å¹´ (360ä¸ªæœˆ)" disabled>
                    </div>
                </div>
            </div>
            
            <!-- è®¡ç®—æŒ‰é’® -->
            <button id="calculateBtn" class="button">
                <span class="emoji">ğŸ§®</span> å¼€å§‹è®¡ç®—
            </button>
            
            <!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
            <div class="loading" id="loadingIndicator">
                <span class="emoji">â³</span> è®¡ç®—ä¸­ï¼Œè¯·ç¨å€™...
            </div>
            
            <!-- è®¡ç®—ç»“æœåŒºåŸŸ -->
            <div class="card" id="resultsCard" style="display: none;">
                <div class="card-title">
                    <span class="emoji">ğŸ“Š</span> è®¡ç®—ç»“æœ
                </div>
                
                <!-- å…³é”®æŒ‡æ ‡å¯¹æ¯” -->
                <div class="result-grid">
                    <div class="result-box">
                        <div class="result-title">æ¯æœˆæœˆä¾›</div>
                        <div class="result-value blue" id="monthlyPaymentResult">--</div>
                        <div class="result-detail">30å¹´ç­‰é¢æœ¬æ¯</div>
                    </div>
                    
                    <div class="result-box">
                        <div class="result-title">å¹³å‡æŒæœ‰æˆæœ¬</div>
                        <div class="result-value red" id="avgMonthlyCost">--</div>
                        <div class="result-detail">æ¯æœˆæœºä¼š+æŠ˜æ—§+åˆ©æ¯</div>
                    </div>
                </div>
                
                <!-- å‰Nå¹´å¹³å‡æŒæœ‰æˆæœ¬è®¾ç½® -->
                <div class="year-cost-selector">
                    <label for="yearCount">å‰ N å¹´å¹³å‡æŒæœ‰æˆæœ¬ï¼š</label>
                    <div class="input-with-unit" style="width: auto;">
                        <input type="number" id="yearCount" min="1" max="30" step="1" value="5">
                        <span class="unit">å¹´</span>
                    </div>
                </div>
                
                <!-- å‰Nå¹´å¹³å‡æŒæœ‰æˆæœ¬ç»“æœ -->
                <div class="year-cost-result">
                    <div class="year-cost-result-item">
                        <span>å‰ <span id="yearCountDisplay">5</span> å¹´å¹³å‡æ¯æœˆæŒæœ‰æˆæœ¬ï¼š</span>
                        <span class="year-cost-value" id="avgCostForNYears">--</span>
                    </div>
                    <div class="year-cost-result-item">
                        <span>å‰ <span id="yearCountDisplay2">5</span> å¹´æ€»æŒæœ‰æˆæœ¬ï¼š</span>
                        <span class="year-cost-value" id="totalCostForNYears">--</span>
                    </div>
                    <div class="year-cost-result-item">
                        <span>å 30å¹´æ€»æˆæœ¬æ¯”ä¾‹ï¼š</span>
                        <span class="year-cost-value" id="costPercentage">--</span>
                    </div>
                    
                    <!-- æ¯”ä¾‹æ¡å½¢å›¾ -->
                    <div class="comparison-bar">
                        <div class="comparison-fill" id="percentageBar" style="width: 0%"></div>
                    </div>
                    
                    <!-- æˆæœ¬æ„æˆåˆ†å¸ƒ -->
                    <div class="cost-distribution">
                        <div class="distribution-item">
                            <div class="distribution-color" style="background-color: #2ecc71;"></div>
                            <div class="distribution-label">æœºä¼šæˆæœ¬å æ¯”ï¼š</div>
                            <div class="distribution-value" id="opportunityPercentage">--</div>
                        </div>
                        <div class="distribution-item">
                            <div class="distribution-color" style="background-color: #9b59b6;"></div>
                            <div class="distribution-label">æŠ˜æ—§æˆæœ¬å æ¯”ï¼š</div>
                            <div class="distribution-value" id="depreciationPercentage">--</div>
                        </div>
                        <div class="distribution-item">
                            <div class="distribution-color" style="background-color: #e74c3c;"></div>
                            <div class="distribution-label">åˆ©æ¯æˆæœ¬å æ¯”ï¼š</div>
                            <div class="distribution-value" id="interestPercentage">--</div>
                        </div>
                    </div>
                </div>
                
                <!-- æœˆä¾›æ˜ç»† -->
                <div class="cost-breakdown">
                    <div class="cost-item">
                        <span>æ¯æœˆæœˆä¾›ï¼š</span>
                        <span id="monthlyPaymentDetail">--</span>
                    </div>
                    <div class="cost-item">
                        <span>å…¶ä¸­åˆ©æ¯ï¼š</span>
                        <span id="monthlyInterestDetail">--</span>
                    </div>
                    <div class="cost-item">
                        <span>å…¶ä¸­æœ¬é‡‘ï¼š</span>
                        <span id="monthlyPrincipalDetail">--</span>
                    </div>
                    <div class="cost-item" style="font-weight: 600; color: #3498db;">
                        <span>30å¹´è¿˜æ¬¾æ€»é¢ï¼š</span>
                        <span id="totalPaymentResult">--</span>
                    </div>
                </div>
                
                <!-- æŒæœ‰æˆæœ¬æ˜ç»† -->
                <div class="cost-breakdown">
                    <div class="cost-item">
                        <div class="cost-label">
                            <div class="cost-icon icon-opportunity">æœº</div>
                            <span>æœºä¼šæˆæœ¬ï¼ˆæ¯æœˆï¼‰ï¼š</span>
                        </div>
                        <span id="avgOpportunityCost">--</span>
                    </div>
                    <div class="cost-item">
                        <div class="cost-label">
                            <div class="cost-icon icon-depreciation">æŠ˜</div>
                            <span>æŠ˜æ—§æˆæœ¬ï¼ˆæ¯æœˆï¼‰ï¼š</span>
                        </div>
                        <span id="avgDepreciationCost">--</span>
                    </div>
                    <div class="cost-item">
                        <div class="cost-label">
                            <div class="cost-icon icon-interest">æ¯</div>
                            <span>å¹³å‡åˆ©æ¯æˆæœ¬ï¼š</span>
                        </div>
                        <span id="avgInterestCost">--</span>
                    </div>
                    <div class="cost-item" style="font-weight: 600; color: #e74c3c;">
                        <div class="cost-label">
                            <div class="cost-icon icon-total">æ€»</div>
                            <span>30å¹´æ€»æŒæœ‰æˆæœ¬ï¼š</span>
                        </div>
                        <span id="total30YearCost">--</span>
                    </div>
                </div>
                
                <!-- é¦–æœ«æœˆå¯¹æ¯” -->
                <div class="cost-breakdown">
                    <div class="cost-item">
                        <span>é¦–æœˆæŒæœ‰æˆæœ¬ï¼š</span>
                        <span id="firstMonthCost">--</span>
                    </div>
                    <div class="cost-item">
                        <span>æœ«æœˆæŒæœ‰æˆæœ¬ï¼š</span>
                        <span id="lastMonthCost">--</span>
                    </div>
                    <div class="cost-item">
                        <span>æŒæœ‰æˆæœ¬å‡å°‘ï¼š</span>
                        <span id="costReduction">--</span>
                    </div>
                </div>
                
                <!-- æ¯æœˆæ˜ç»†è¡¨æ ¼ï¼ˆå¯æŠ˜å ï¼‰ -->
                <div class="collapse-header" id="monthlyDetailHeader">
                    <div class="card-title">
                        <span class="emoji">ğŸ“ˆ</span> æ¯æœˆæ˜ç»†ï¼ˆç‚¹å‡»å±•å¼€ï¼‰
                    </div>
                    <div class="collapse-arrow">â–¼</div>
                </div>
                
                <div class="collapse-content" id="monthlyDetailContent">
                    <div class="time-filter">
                        <div class="time-btn active" data-years="5">å‰5å¹´</div>
                        <div class="time-btn" data-years="10">å‰10å¹´</div>
                        <div class="time-btn" data-years="1">ç¬¬1å¹´</div>
                        <div class="time-btn" data-years="last5">æœ€å5å¹´</div>
                    </div>
                    
                    <div class="month-selector">
                        <span>è·³è½¬åˆ°ç¬¬</span>
                        <input type="number" id="jumpToMonth" min="1" max="360" value="1">
                        <span>ä¸ªæœˆ</span>
                        <button id="jumpBtn">è·³è½¬</button>
                    </div>
                    
                    <div class="monthly-table-container">
                        <table class="monthly-table" id="monthlyTable">
                            <thead>
                                <tr>
                                    <th>æœŸæ•°</th>
                                    <th>å¹´ä»½</th>
                                    <th>æœˆä»½</th>
                                    <th>æœˆä¾›</th>
                                    <th>åˆ©æ¯</th>
                                    <th>æœ¬é‡‘</th>
                                    <th>æŒæœ‰æˆæœ¬</th>
                                </tr>
                            </thead>
                            <tbody id="monthlyTableBody">
                                <!-- æ¯æœˆæ•°æ®å°†é€šè¿‡JavaScriptå¡«å…… -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- ä½¿ç”¨è¯´æ˜ -->
            <div class="note">
                <p><strong>ğŸ“ è®¡ç®—å…¬å¼è¯´æ˜ï¼š</strong></p>
                <p>æ¯æœˆæŒæœ‰æˆæœ¬ = <span class="highlight">æœºä¼šæˆæœ¬</span> + <span class="highlight">æŠ˜æ—§æˆæœ¬</span> + <span class="highlight">å½“æœˆåˆ©æ¯</span></p>
                <p>â€¢ æœºä¼šæˆæœ¬ = é¦–ä»˜é‡‘é¢ Ã— æœºä¼šæˆæœ¬å¹´åˆ©ç‡ Ã· 12</p>
                <p>â€¢ æŠ˜æ—§æˆæœ¬ = æˆ¿å±‹æ€»ä»· Ã— 1% Ã· 12ï¼ˆå›ºå®šï¼‰</p>
                <p>â€¢ å½“æœˆåˆ©æ¯ = ç­‰é¢æœ¬æ¯å½“æœˆå®é™…åˆ©æ¯ï¼ˆæ¯æœˆé€’å‡ï¼‰</p>
                <p>â€¢ å‰Nå¹´å¹³å‡æŒæœ‰æˆæœ¬ = å‰Nå¹´æ€»æŒæœ‰æˆæœ¬ Ã· (N Ã— 12)</p>
            </div>
        </div>
        
        <div class="footer">
            <p>Â© 2023 ç§»åŠ¨ç«¯æˆ¿äº§æŒæœ‰æˆæœ¬è®¡ç®—å™¨</p>
            <p style="margin-top: 5px;">è®¡ç®—ç»“æœä»…ä¾›å‚è€ƒï¼Œå®é™…ä»¥é‡‘èæœºæ„å®¡æ‰¹ä¸ºå‡†</p>
        </div>
    </div>

    <script>
        // DOMå…ƒç´ 
        const totalPriceInput = document.getElementById('totalPrice');
        const totalPriceSlider = document.getElementById('totalPriceSlider');
        const downPaymentInput = document.getElementById('downPayment');
        const downPaymentSlider = document.getElementById('downPaymentSlider');
        const downPaymentPercentage = document.getElementById('downPaymentPercentage');
        const rateLimitInput = document.getElementById('rateLimit');
        const opportunityRateInput = document.getElementById('opportunityRate');
        const rate1Input = document.getElementById('rate1');
        const rate2Input = document.getElementById('rate2');
        const calculateBtn = document.getElementById('calculateBtn');
        const resultsCard = document.getElementById('resultsCard');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const yearCountInput = document.getElementById('yearCount');
        
        // æŠ˜å é¢æ¿å…ƒç´ 
        const customParamsHeader = document.getElementById('customParamsHeader');
        const customParamsContent = document.getElementById('customParamsContent');
        const monthlyDetailHeader = document.getElementById('monthlyDetailHeader');
        const monthlyDetailContent = document.getElementById('monthlyDetailContent');
        
        // é”™è¯¯æç¤ºå…ƒç´ 
        const totalPriceError = document.getElementById('totalPriceError');
        const downPaymentError = document.getElementById('downPaymentError');
        
        // æ‘˜è¦å…ƒç´ 
        const summaryTotalPrice = document.getElementById('summaryTotalPrice');
        const summaryDownPayment = document.getElementById('summaryDownPayment');
        const summaryLoanAmount = document.getElementById('summaryLoanAmount');
        const summaryRateSplit = document.getElementById('summaryRateSplit');
        
        // ç»“æœå…ƒç´ 
        const monthlyPaymentResult = document.getElementById('monthlyPaymentResult');
        const avgMonthlyCost = document.getElementById('avgMonthlyCost');
        const monthlyPaymentDetail = document.getElementById('monthlyPaymentDetail');
        const monthlyInterestDetail = document.getElementById('monthlyInterestDetail');
        const monthlyPrincipalDetail = document.getElementById('monthlyPrincipalDetail');
        const totalPaymentResult = document.getElementById('totalPaymentResult');
        const avgOpportunityCost = document.getElementById('avgOpportunityCost');
        const avgDepreciationCost = document.getElementById('avgDepreciationCost');
        const avgInterestCost = document.getElementById('avgInterestCost');
        const total30YearCost = document.getElementById('total30YearCost');
        const firstMonthCost = document.getElementById('firstMonthCost');
        const lastMonthCost = document.getElementById('lastMonthCost');
        const costReductionEl = document.getElementById('costReduction');
        
        // å‰Nå¹´å¹³å‡æˆæœ¬å…ƒç´ 
        const yearCountDisplay = document.getElementById('yearCountDisplay');
        const yearCountDisplay2 = document.getElementById('yearCountDisplay2');
        const avgCostForNYears = document.getElementById('avgCostForNYears');
        const totalCostForNYears = document.getElementById('totalCostForNYears');
        const costPercentage = document.getElementById('costPercentage');
        const percentageBar = document.getElementById('percentageBar');
        const opportunityPercentage = document.getElementById('opportunityPercentage');
        const depreciationPercentage = document.getElementById('depreciationPercentage');
        const interestPercentage = document.getElementById('interestPercentage');
        
        // è¡¨æ ¼å…ƒç´ 
        const monthlyTableBody = document.getElementById('monthlyTableBody');
        const jumpToMonthInput = document.getElementById('jumpToMonth');
        const jumpBtn = document.getElementById('jumpBtn');
        
        // å…¨å±€å˜é‡
        let monthlyData = [];
        const LOAN_TERM_YEARS = 30;
        const MONTHS_PER_YEAR = 12;
        const TOTAL_MONTHS = LOAN_TERM_YEARS * MONTHS_PER_YEAR;
        const DEPRECIATION_RATE = 0.01; // å¹´æŠ˜æ—§ç‡1%
        
        // åˆå§‹åŒ–å‡½æ•°
        function init() {
            // è®¾ç½®æŠ˜å é¢æ¿
            setupCollapse();
            
            // è®¾ç½®æ—¶é—´è¿‡æ»¤æŒ‰é’®äº‹ä»¶
            setupTimeFilters();
            
            // è®¾ç½®è·³è½¬æŒ‰é’®äº‹ä»¶
            setupJumpButton();
            
            // æ›´æ–°æ‘˜è¦ä¿¡æ¯
            updateSummary();
            
            // æ›´æ–°é¦–ä»˜æ¯”ä¾‹
            updateDownPaymentPercentage();
            
            // ç»‘å®šè¾“å…¥äº‹ä»¶
            setupInputEvents();
            
            // åˆå§‹è®¡ç®—
            setTimeout(calculate, 500);
        }
        
        // è®¾ç½®æŠ˜å é¢æ¿
        function setupCollapse() {
            customParamsHeader.addEventListener('click', function() {
                customParamsContent.classList.toggle('active');
                this.querySelector('.collapse-arrow').classList.toggle('active');
            });
            
            monthlyDetailHeader.addEventListener('click', function() {
                monthlyDetailContent.classList.toggle('active');
                this.querySelector('.collapse-arrow').classList.toggle('active');
            });
        }
        
        // è®¾ç½®æ—¶é—´è¿‡æ»¤æŒ‰é’®
        function setupTimeFilters() {
            const timeBtns = document.querySelectorAll('.time-btn');
            timeBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    timeBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const years = this.getAttribute('data-years');
                    updateMonthlyTable(years);
                });
            });
        }
        
        // è®¾ç½®è·³è½¬æŒ‰é’®
        function setupJumpButton() {
            jumpBtn.addEventListener('click', function() {
                const month = parseInt(jumpToMonthInput.value);
                if (month >= 1 && month <= 360) {
                    // æ‰¾åˆ°å¯¹åº”æœˆä»½æ‰€åœ¨çš„è¡Œå¹¶æ»šåŠ¨åˆ°è¯¥ä½ç½®
                    const rows = monthlyTableBody.querySelectorAll('tr');
                    if (rows.length >= month) {
                        rows[month - 1].scrollIntoView({ behavior: 'smooth', block: 'center' });
                        // é«˜äº®æ˜¾ç¤ºè¯¥è¡Œ
                        rows.forEach(row => row.style.backgroundColor = '');
                        rows[month - 1].style.backgroundColor = '#fffacd';
                        
                        // 2ç§’åå–æ¶ˆé«˜äº®
                        setTimeout(() => {
                            rows[month - 1].style.backgroundColor = '';
                        }, 2000);
                    }
                }
            });
        }
        
        // è®¾ç½®è¾“å…¥äº‹ä»¶
        function setupInputEvents() {
            // åŒæ­¥è¾“å…¥æ¡†å’Œæ»‘å—ï¼ˆæˆ¿å±‹æ€»ä»·ï¼‰
            totalPriceInput.addEventListener('input', function() {
                const value = parseFloat(this.value);
                totalPriceSlider.value = value;
                validateTotalPrice(value);
                updateDownPaymentPercentage();
                updateSummary();
            });
            
            totalPriceSlider.addEventListener('input', function() {
                const value = parseFloat(this.value);
                totalPriceInput.value = value;
                validateTotalPrice(value);
                updateDownPaymentPercentage();
                updateSummary();
            });
            
            // åŒæ­¥è¾“å…¥æ¡†å’Œæ»‘å—ï¼ˆé¦–ä»˜ï¼‰
            downPaymentInput.addEventListener('input', function() {
                const value = parseFloat(this.value);
                downPaymentSlider.value = value;
                validateDownPayment(value);
                updateDownPaymentPercentage();
                updateSummary();
            });
            
            downPaymentSlider.addEventListener('input', function() {
                const value = parseFloat(this.value);
                downPaymentInput.value = value;
                validateDownPayment(value);
                updateDownPaymentPercentage();
                updateSummary();
            });
            
            // è‡ªå®šä¹‰å‚æ•°å˜åŒ–æ—¶æ›´æ–°æ‘˜è¦
            rateLimitInput.addEventListener('input', updateSummary);
            rate1Input.addEventListener('input', updateSummary);
            rate2Input.addEventListener('input', updateSummary);
            
            // å‰Nå¹´è¾“å…¥å˜åŒ–æ—¶æ›´æ–°ç»“æœ
            yearCountInput.addEventListener('input', function() {
                const yearCount = parseInt(this.value);
                if (yearCount >= 1 && yearCount <= 30) {
                    yearCountDisplay.textContent = yearCount;
                    yearCountDisplay2.textContent = yearCount;
                    if (monthlyData.length > 0) {
                        updateYearCostResults(yearCount);
                    }
                }
            });
        }
        
        // æ›´æ–°æ‘˜è¦ä¿¡æ¯
        function updateSummary() {
            const totalPrice = parseFloat(totalPriceInput.value);
            const downPayment = parseFloat(downPaymentInput.value);
            const loanAmount = totalPrice - downPayment;
            const rateLimit = parseFloat(rateLimitInput.value);
            const rate1 = parseFloat(rate1Input.value);
            const rate2 = parseFloat(rate2Input.value);
            
            summaryTotalPrice.textContent = totalPrice.toFixed(1) + ' ä¸‡å…ƒ';
            summaryDownPayment.textContent = downPayment.toFixed(1) + ' ä¸‡å…ƒ';
            summaryLoanAmount.textContent = loanAmount > 0 ? loanAmount.toFixed(1) + ' ä¸‡å…ƒ' : '0 ä¸‡å…ƒ';
            summaryRateSplit.textContent = `â‰¤${rateLimit}ä¸‡:${rate1}% >${rateLimit}ä¸‡:${rate2}%`;
        }
        
        // æ›´æ–°é¦–ä»˜æ¯”ä¾‹
        function updateDownPaymentPercentage() {
            const totalPrice = parseFloat(totalPriceInput.value);
            const downPayment = parseFloat(downPaymentInput.value);
            
            if (totalPrice > 0) {
                const percentage = (downPayment / totalPrice * 100).toFixed(1);
                downPaymentPercentage.textContent = `é¦–ä»˜æ¯”ä¾‹ï¼š${percentage}%`;
            }
        }
        
        // éªŒè¯æˆ¿å±‹æ€»ä»·
        function validateTotalPrice(value) {
            if (isNaN(value) || value <= 0) {
                totalPriceError.textContent = 'è¯·è¾“å…¥æœ‰æ•ˆçš„æˆ¿å±‹æ€»ä»·';
                totalPriceError.style.display = 'block';
                return false;
            } else if (value > 2000) {
                totalPriceError.textContent = 'æˆ¿å±‹æ€»ä»·ä¸èƒ½è¶…è¿‡2000ä¸‡å…ƒ';
                totalPriceError.style.display = 'block';
                return false;
            } else {
                totalPriceError.style.display = 'none';
                return true;
            }
        }
        
        // éªŒè¯é¦–ä»˜é‡‘é¢
        function validateDownPayment(value) {
            const totalPrice = parseFloat(totalPriceInput.value);
            
            if (isNaN(value) || value < 0) {
                downPaymentError.textContent = 'è¯·è¾“å…¥æœ‰æ•ˆçš„é¦–ä»˜é‡‘é¢';
                downPaymentError.style.display = 'block';
                return false;
            } else if (value > totalPrice) {
                downPaymentError.textContent = 'é¦–ä»˜é‡‘é¢ä¸èƒ½è¶…è¿‡æˆ¿å±‹æ€»ä»·';
                downPaymentError.style.display = 'block';
                return false;
            } else {
                downPaymentError.style.display = 'none';
                return true;
            }
        }
        
        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading() {
            loadingIndicator.style.display = 'block';
            calculateBtn.disabled = true;
            calculateBtn.innerHTML = '<span class="emoji">â³</span> è®¡ç®—ä¸­...';
        }
        
        // éšè—åŠ è½½çŠ¶æ€
        function hideLoading() {
            loadingIndicator.style.display = 'none';
            calculateBtn.disabled = false;
            calculateBtn.innerHTML = '<span class="emoji">ğŸ§®</span> å¼€å§‹è®¡ç®—';
        }
        
        // è®¡ç®—ç­‰é¢æœ¬æ¯æ¯æœˆè¿˜æ¬¾æ˜ç»†ï¼ˆåˆ†æ®µåˆ©ç‡ï¼‰
        function calculateAmortizationSchedule(loanAmountYuan, limitYuan, rate1, rate2) {
            // åˆ†æ®µè®¡ç®—
            let part1 = 0, part2 = 0;
            
            if (loanAmountYuan <= limitYuan) {
                // å…¨éƒ¨ä½¿ç”¨åˆ©ç‡1
                part1 = loanAmountYuan;
            } else {
                // ç¬¬ä¸€éƒ¨åˆ†ä½¿ç”¨åˆ©ç‡1
                part1 = limitYuan;
                // ç¬¬äºŒéƒ¨åˆ†ä½¿ç”¨åˆ©ç‡2
                part2 = loanAmountYuan - limitYuan;
            }
            
            // è®¡ç®—æ¯éƒ¨åˆ†çš„æœˆä¾›å’Œè¿˜æ¬¾è®¡åˆ’
            const schedule1 = part1 > 0 ? calculateEqualPrincipalAndInterest(part1, rate1, TOTAL_MONTHS) : [];
            const schedule2 = part2 > 0 ? calculateEqualPrincipalAndInterest(part2, rate2, TOTAL_MONTHS) : [];
            
            // åˆå¹¶ä¸¤éƒ¨åˆ†
            const schedule = [];
            let totalMonthlyPayment = 0;
            let totalInterest = 0;
            let totalPrincipal = 0;
            
            for (let i = 0; i < TOTAL_MONTHS; i++) {
                const month1 = schedule1[i] || { interest: 0, principal: 0, payment: 0 };
                const month2 = schedule2[i] || { interest: 0, principal: 0, payment: 0 };
                
                const interest = month1.interest + month2.interest;
                const principal = month1.principal + month2.principal;
                const payment = month1.payment + month2.payment;
                
                schedule.push({
                    month: i + 1,
                    interest,
                    principal,
                    payment
                });
                
                if (i === 0) {
                    totalMonthlyPayment = payment;
                }
                
                totalInterest += interest;
                totalPrincipal += principal;
            }
            
            return {
                schedule,
                totalMonthlyPayment,
                totalInterest,
                totalPrincipal
            };
        }
        
        // è®¡ç®—ç­‰é¢æœ¬æ¯è¿˜æ¬¾è®¡åˆ’
        function calculateEqualPrincipalAndInterest(principal, annualRate, months) {
            const monthlyRate = annualRate / 100 / MONTHS_PER_YEAR; // è½¬æ¢ä¸ºå°æ•°å¹¶è®¡ç®—æœˆåˆ©ç‡
            const monthlyPayment = principal * monthlyRate * Math.pow(1 + monthlyRate, months) / (Math.pow(1 + monthlyRate, months) - 1);
            
            const schedule = [];
            let remainingPrincipal = principal;
            
            for (let i = 0; i < months; i++) {
                const interest = remainingPrincipal * monthlyRate;
                const principalPaid = monthlyPayment - interest;
                remainingPrincipal -= principalPaid;
                
                schedule.push({
                    interest,
                    principal: principalPaid,
                    payment: monthlyPayment
                });
            }
            
            return schedule;
        }
        
        // è®¡ç®—æ¯æœˆæŒæœ‰æˆæœ¬æ˜ç»†
        function calculateMonthlyCosts(totalPrice, downPayment, loanAmount, rateLimit, opportunityRate, rate1, rate2) {
            // è½¬æ¢ä¸ºå…ƒ
            const totalPriceYuan = totalPrice * 10000;
            const downPaymentYuan = downPayment * 10000;
            const loanAmountYuan = loanAmount * 10000;
            const limitYuan = rateLimit * 10000;
            
            // è®¡ç®—ç­‰é¢æœ¬æ¯è¿˜æ¬¾è®¡åˆ’
            const amortization = calculateAmortizationSchedule(loanAmountYuan, limitYuan, rate1, rate2);
            const schedule = amortization.schedule;
            
            // è®¡ç®—æœºä¼šæˆæœ¬ï¼ˆæ¯æœˆå›ºå®šï¼‰
            const monthlyOpportunityCost = downPaymentYuan * (opportunityRate / 100) / MONTHS_PER_YEAR;
            
            // è®¡ç®—æŠ˜æ—§æˆæœ¬ï¼ˆæ¯æœˆå›ºå®šï¼‰
            const monthlyDepreciation = totalPriceYuan * DEPRECIATION_RATE / MONTHS_PER_YEAR;
            
            // è®¡ç®—æ¯æœˆæŒæœ‰æˆæœ¬
            const monthlyCosts = [];
            let totalHoldingCost = 0;
            let totalOpportunityCost = 0;
            let totalDepreciationCost = 0;
            let totalInterestCost = 0;
            
            for (let i = 0; i < TOTAL_MONTHS; i++) {
                const monthData = schedule[i];
                const month = i + 1;
                const year = Math.ceil(month / MONTHS_PER_YEAR);
                const monthInYear = month % MONTHS_PER_YEAR || MONTHS_PER_YEAR;
                
                const interest = monthData.interest;
                const holdingCost = monthlyOpportunityCost + monthlyDepreciation + interest;
                
                totalHoldingCost += holdingCost;
                totalOpportunityCost += monthlyOpportunityCost;
                totalDepreciationCost += monthlyDepreciation;
                totalInterestCost += interest;
                
                monthlyCosts.push({
                    month,
                    year,
                    monthInYear,
                    payment: monthData.payment,
                    interest,
                    principal: monthData.principal,
                    opportunityCost: monthlyOpportunityCost,
                    depreciation: monthlyDepreciation,
                    holdingCost
                });
            }
            
            return {
                monthlyCosts,
                totalMonthlyPayment: amortization.totalMonthlyPayment,
                totalInterest: amortization.totalInterest,
                totalPayment: amortization.totalMonthlyPayment * TOTAL_MONTHS,
                monthlyOpportunityCost,
                monthlyDepreciation,
                totalHoldingCost,
                totalOpportunityCost,
                totalDepreciationCost,
                totalInterestCost
            };
        }
        
        // è®¡ç®—å‰Nå¹´å¹³å‡æŒæœ‰æˆæœ¬
        function calculateYearCosts(monthlyData, yearCount) {
            const months = Math.min(yearCount * MONTHS_PER_YEAR, monthlyData.length);
            
            let totalCost = 0;
            let totalOpportunity = 0;
            let totalDepreciation = 0;
            let totalInterest = 0;
            
            for (let i = 0; i < months; i++) {
                const data = monthlyData[i];
                totalCost += data.holdingCost;
                totalOpportunity += data.opportunityCost;
                totalDepreciation += data.depreciation;
                totalInterest += data.interest;
            }
            
            const avgMonthlyCost = totalCost / months;
            
            return {
                totalCost,
                avgMonthlyCost,
                totalOpportunity,
                totalDepreciation,
                totalInterest,
                months
            };
        }
        
        // æ ¼å¼åŒ–é‡‘é¢æ˜¾ç¤º
        function formatCurrency(amount, unit = 'å…ƒ') {
            if (amount >= 100000000) {
                return (amount / 100000000).toFixed(2) + 'äº¿';
            } else if (amount >= 10000) {
                return (amount / 10000).toFixed(1) + 'ä¸‡';
            } else {
                return amount.toFixed(0) + unit;
            }
        }
        
        // æ ¼å¼åŒ–äººæ°‘å¸æ˜¾ç¤ºï¼ˆç®€åŒ–ç‰ˆï¼Œé€‚åˆç§»åŠ¨ç«¯ï¼‰
        function formatRMB(amount) {
            if (amount >= 10000) {
                return 'Â¥' + (amount / 10000).toFixed(1) + 'ä¸‡';
            } else {
                return 'Â¥' + amount.toLocaleString('zh-CN', { maximumFractionDigits: 0 });
            }
        }
        
        // æ›´æ–°æ¯æœˆæ˜ç»†è¡¨æ ¼
        function updateMonthlyTable(yearsFilter) {
            if (monthlyData.length === 0) return;
            
            monthlyTableBody.innerHTML = '';
            let monthsToShow = 360;
            
            // æ ¹æ®ç­›é€‰æ¡ä»¶ç¡®å®šæ˜¾ç¤ºå¤šå°‘ä¸ªæœˆ
            if (yearsFilter === '5') {
                monthsToShow = 5 * MONTHS_PER_YEAR;
            } else if (yearsFilter === '10') {
                monthsToShow = 10 * MONTHS_PER_YEAR;
            } else if (yearsFilter === '1') {
                monthsToShow = 1 * MONTHS_PER_YEAR;
            } else if (yearsFilter === 'last5') {
                // æ˜¾ç¤ºæœ€å5å¹´ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†
                const startMonth = 360 - 5 * MONTHS_PER_YEAR + 1;
                for (let i = startMonth - 1; i < 360; i++) {
                    addRowToTable(monthlyData[i]);
                }
                return;
            }
            
            for (let i = 0; i < monthsToShow; i++) {
                addRowToTable(monthlyData[i]);
            }
        }
        
        // æ·»åŠ è¡Œåˆ°è¡¨æ ¼ï¼ˆç§»åŠ¨ç«¯ç®€åŒ–ç‰ˆï¼‰
        function addRowToTable(data) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${data.month}</td>
                <td>${data.year}</td>
                <td>${data.monthInYear}</td>
                <td>${formatRMB(data.payment)}</td>
                <td>${formatRMB(data.interest)}</td>
                <td>${formatRMB(data.principal)}</td>
                <td>${formatRMB(data.holdingCost)}</td>
            `;
            monthlyTableBody.appendChild(row);
        }
        
        // æ›´æ–°å‰Nå¹´æˆæœ¬ç»“æœ
        function updateYearCostResults(yearCount) {
            if (monthlyData.length === 0) return;
            
            const yearCosts = calculateYearCosts(monthlyData, yearCount);
            
            // æ›´æ–°æ˜¾ç¤º
            avgCostForNYears.textContent = formatRMB(yearCosts.avgMonthlyCost);
            totalCostForNYears.textContent = formatRMB(yearCosts.totalCost);
            
            // è®¡ç®—å æ¯”
            const total30YearCostValue = monthlyData.reduce((sum, item) => sum + item.holdingCost, 0);
            const percentage = (yearCosts.totalCost / total30YearCostValue * 100).toFixed(1);
            costPercentage.textContent = percentage + '%';
            
            // æ›´æ–°æ¡å½¢å›¾
            percentageBar.style.width = percentage + '%';
            
            // æ›´æ–°æˆæœ¬æ„æˆåˆ†å¸ƒ
            const totalCost = yearCosts.totalCost;
            const opportunityPercent = (yearCosts.totalOpportunity / totalCost * 100).toFixed(1);
            const depreciationPercent = (yearCosts.totalDepreciation / totalCost * 100).toFixed(1);
            const interestPercent = (yearCosts.totalInterest / totalCost * 100).toFixed(1);
            
            opportunityPercentage.textContent = opportunityPercent + '%';
            depreciationPercentage.textContent = depreciationPercent + '%';
            interestPercentage.textContent = interestPercent + '%';
        }
        
        // æ‰§è¡Œè®¡ç®—
        async function calculate() {
            const totalPrice = parseFloat(totalPriceInput.value);
            const downPayment = parseFloat(downPaymentInput.value);
            const rateLimit = parseFloat(rateLimitInput.value);
            const opportunityRate = parseFloat(opportunityRateInput.value);
            const rate1 = parseFloat(rate1Input.value);
            const rate2 = parseFloat(rate2Input.value);
            const yearCount = parseInt(yearCountInput.value);
            
            if (!validateTotalPrice(totalPrice) || !validateDownPayment(downPayment)) {
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            showLoading();
            
            // ä½¿ç”¨setTimeoutè®©UIæœ‰æœºä¼šæ›´æ–°
            await new Promise(resolve => setTimeout(resolve, 50));
            
            // è®¡ç®—è´·æ¬¾é‡‘é¢
            const loanAmount = totalPrice - downPayment;
            
            if (loanAmount <= 0) {
                // å…¨æ¬¾è´­æˆ¿çš„æƒ…å†µ
                hideLoading();
                alert("å…¨æ¬¾è´­æˆ¿æ— éœ€è´·æ¬¾ï¼ŒæŒæœ‰æˆæœ¬ä»…åŒ…æ‹¬æœºä¼šæˆæœ¬å’ŒæŠ˜æ—§æˆæœ¬");
                return;
            }
            
            try {
                // è®¡ç®—æ¯æœˆæŒæœ‰æˆæœ¬æ˜ç»†
                const result = calculateMonthlyCosts(totalPrice, downPayment, loanAmount, rateLimit, opportunityRate, rate1, rate2);
                
                // ä¿å­˜æ¯æœˆæ•°æ®
                monthlyData = result.monthlyCosts;
                
                // æ›´æ–°æ±‡æ€»ç»“æœ
                updateSummaryResults(result, loanAmount);
                
                // æ›´æ–°å‰Nå¹´æˆæœ¬ç»“æœ
                updateYearCostResults(yearCount);
                
                // æ›´æ–°æ¯æœˆæ˜ç»†è¡¨æ ¼ï¼ˆé»˜è®¤æ˜¾ç¤ºå‰5å¹´ï¼‰
                updateMonthlyTable('5');
                
                // æ˜¾ç¤ºç»“æœåŒºåŸŸ
                resultsCard.style.display = 'block';
                
                // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
                setTimeout(() => {
                    resultsCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 300);
                
            } catch (error) {
                console.error('è®¡ç®—é”™è¯¯:', error);
                alert('è®¡ç®—è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œè¯·æ£€æŸ¥è¾“å…¥å‚æ•°');
            } finally {
                // éšè—åŠ è½½çŠ¶æ€
                hideLoading();
            }
        }
        
        // æ›´æ–°æ±‡æ€»ç»“æœ
        function updateSummaryResults(result, loanAmount) {
            // è®¡ç®—å¹³å‡åˆ©æ¯
            const avgInterest = result.totalInterest / TOTAL_MONTHS;
            
            // è®¡ç®—å¹³å‡æŒæœ‰æˆæœ¬
            const avgHoldingCost = result.totalHoldingCost / TOTAL_MONTHS;
            
            // é¦–æœˆä¸æœ«æœˆæ•°æ®
            const firstMonth = monthlyData[0];
            const lastMonth = monthlyData[monthlyData.length - 1];
            
            // æ¯æœˆæœˆä¾›ç›¸å…³
            monthlyPaymentResult.textContent = formatRMB(result.totalMonthlyPayment);
            monthlyPaymentDetail.textContent = formatRMB(result.totalMonthlyPayment);
            monthlyInterestDetail.textContent = formatRMB(firstMonth.interest);
            monthlyPrincipalDetail.textContent = formatRMB(firstMonth.principal);
            totalPaymentResult.textContent = formatRMB(result.totalPayment);
            
            // å¹³å‡æŒæœ‰æˆæœ¬ç›¸å…³
            avgMonthlyCost.textContent = formatRMB(avgHoldingCost);
            avgOpportunityCost.textContent = formatRMB(result.monthlyOpportunityCost);
            avgDepreciationCost.textContent = formatRMB(result.monthlyDepreciation);
            avgInterestCost.textContent = formatRMB(avgInterest);
            total30YearCost.textContent = formatRMB(result.totalHoldingCost);
            
            // é¦–æœˆä¸æœ«æœˆå¯¹æ¯”
            firstMonthCost.textContent = formatRMB(firstMonth.holdingCost);
            lastMonthCost.textContent = formatRMB(lastMonth.holdingCost);
            
            const costReductionValue = firstMonth.holdingCost - lastMonth.holdingCost;
            costReductionEl.textContent = formatRMB(costReductionValue);
        }
        
        // ç»‘å®šè®¡ç®—æŒ‰é’®äº‹ä»¶
        calculateBtn.addEventListener('click', calculate);
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', init);
        
        // é˜²æŠ–å‡½æ•°ï¼Œç”¨äºè¾“å…¥å˜åŒ–æ—¶çš„è‡ªåŠ¨è®¡ç®—
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        // è¾“å…¥å˜åŒ–æ—¶è‡ªåŠ¨è®¡ç®—ï¼ˆé˜²æŠ–å¤„ç†ï¼Œé¿å…é¢‘ç¹è®¡ç®—ï¼‰
        const debouncedCalculate = debounce(calculate, 800);
        
        // ç›‘å¬è¾“å…¥å˜åŒ–ï¼ˆä¸åŒ…æ‹¬æ»‘å—ï¼Œé¿å…æ‹–åŠ¨æ—¶é¢‘ç¹è®¡ç®—ï¼‰
        const autoCalculateInputs = [
            totalPriceInput, downPaymentInput,
            rateLimitInput, opportunityRateInput,
            rate1Input, rate2Input, yearCountInput
        ];
        
        autoCalculateInputs.forEach(input => {
            input.addEventListener('input', debouncedCalculate);
        });
        
        // æ»‘å—å˜åŒ–æ—¶åªæ›´æ–°æ˜¾ç¤ºï¼Œä¸è‡ªåŠ¨è®¡ç®—
        totalPriceSlider.addEventListener('input', function() {
            const value = parseFloat(this.value);
            totalPriceInput.value = value;
            updateDownPaymentPercentage();
            updateSummary();
        });
        
        downPaymentSlider.addEventListener('input', function() {
            const value = parseFloat(this.value);
            downPaymentInput.value = value;
            updateDownPaymentPercentage();
            updateSummary();
        });
    </script>
</body>
</html>
